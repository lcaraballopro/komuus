
> komu-backend@1.0.0 pretest
> NODE_ENV=test sequelize db:migrate && NODE_ENV=test sequelize db:seed:all


[4mSequelize CLI [Node: 24.13.0, CLI: 5.5.1, ORM: 5.22.5][24m

Loaded configuration file "dist/config/database.js".
(node:990490) [DEP0176] DeprecationWarning: fs.R_OK is deprecated, use fs.constants.R_OK instead
(Use `node --trace-deprecation ...` to show where the warning was created)
No migrations were executed, database schema was already up to date.

[4mSequelize CLI [Node: 24.13.0, CLI: 5.5.1, ORM: 5.22.5][24m

Loaded configuration file "dist/config/database.js".
(node:990501) [DEP0176] DeprecationWarning: fs.R_OK is deprecated, use fs.constants.R_OK instead
(Use `node --trace-deprecation ...` to show where the warning was created)
== 20200904070004-create-default-settings: migrating =======
== 20200904070004-create-default-settings: migrated (0.005s)

== 20200904070004-create-default-users: migrating =======
== 20200904070004-create-default-users: migrated (0.002s)

== 20200904070006-create-apiToken-settings: migrating =======
== 20200904070006-create-apiToken-settings: migrated (0.002s)


> komu-backend@1.0.0 test
> NODE_ENV=test jest

PASS src/__tests__/unit/User/AuthUserService.spec.ts
  ‚óè Console

    console.log
      [DEBUG] AuthUserService found user: ID 1, Email Elnora.Hilll@hotmail.com, Hash $2a$08$4a2paXwjSvdFlBENkf6DQ.OqEBFg.bEvdIoMOLGe.il7ZFZjpreOS

      at src/services/UserServices/AuthUserService.ts:39:13

    console.log
      [DEBUG] checkPassword: Input 'HqJgm7U3cXWvXdj' vs Stored '$2a$08$4a2paXwjSvdFlBENkf6DQ.OqEBFg.bEvdIoMOLGe.il7ZFZjpreOS' = true

      at User.<anonymous> (src/models/User.ts:97:13)

    console.log
      [DEBUG] AuthUserService found NO user for email Osbaldo_Schimmel59@yahoo.com

      at src/services/UserServices/AuthUserService.ts:41:13

    console.log
      [DEBUG] AuthUserService found user: ID 1, Email mail@test.com, Hash $2a$08$WfeoY04y4QW9o76V9Hj3penrx5/3FSI5y.yj/Y7j3HRmozWHjLne.

      at src/services/UserServices/AuthUserService.ts:39:13

    console.log
      [DEBUG] checkPassword: Input 'RfABo7cwzfNbCj5' vs Stored '$2a$08$WfeoY04y4QW9o76V9Hj3penrx5/3FSI5y.yj/Y7j3HRmozWHjLne.' = false

      at User.<anonymous> (src/models/User.ts:97:13)

PASS src/__tests__/unit/User/UpdateUserService.spec.ts
  ‚óè Console

    console.log
      Deprecation Warning: faker.random.number is now located in faker.datatype.number

      at Random.number (node_modules/faker/lib/random.js:37:13)

PASS src/__tests__/unit/User/ListUserService.spec.ts
PASS src/__tests__/unit/User/ShowUserService.spec.ts
  ‚óè Console

    console.log
      Deprecation Warning: faker.random.number is now located in faker.datatype.number

      at Random.number (node_modules/faker/lib/random.js:37:13)

PASS src/__tests__/unit/User/CreateUserService.spec.ts
FAIL src/__tests__/unit/User/DeleteUserService.spec.ts
  ‚óè Test suite failed to run

    ENOENT: no such file or directory, open 'node:fs/promises'

      at Runtime.readFile (node_modules/jest-runtime/build/index.js:1987:21)
      at Object.<anonymous> (node_modules/puppeteer-core/src/node/ChromeLauncher.ts:7:1)

-------------------------------------|---------|----------|---------|---------|-------------------
File                                 | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s 
-------------------------------------|---------|----------|---------|---------|-------------------
All files                            |    4.46 |    21.48 |    4.62 |    4.46 |                   
 services                            |       0 |        0 |       0 |       0 |                   
  WebPushService.ts                  |       0 |        0 |       0 |       0 | 1-65              
 services/AIAgentService             |       0 |        0 |       0 |       0 |                   
  CreateAIAgentService.ts            |       0 |        0 |       0 |       0 | 1-29              
  DeleteAIAgentService.ts            |       0 |        0 |       0 |       0 | 1-21              
  ListAIAgentsService.ts             |       0 |        0 |       0 |       0 | 1-34              
  ShowAIAgentService.ts              |       0 |        0 |       0 |       0 | 1-21              
  UpdateAIAgentService.ts            |       0 |        0 |       0 |       0 | 1-44              
 services/AuthServices               |       0 |        0 |       0 |       0 |                   
  RefreshTokenService.ts             |       0 |        0 |       0 |       0 | 1-47              
 services/BotStateService            |       0 |        0 |       0 |       0 |                   
  BotStateService.ts                 |       0 |        0 |       0 |       0 | 1-129             
 services/CloseReasonService         |       0 |        0 |       0 |       0 |                   
  CreateCloseReasonService.ts        |       0 |        0 |       0 |       0 | 1-30              
  DeleteCloseReasonService.ts        |       0 |        0 |       0 |       0 | 1-22              
  ListCloseReasonsService.ts         |       0 |        0 |       0 |       0 | 1-39              
  ShowCloseReasonService.ts          |       0 |        0 |       0 |       0 | 1-21              
  UpdateCloseReasonService.ts        |       0 |        0 |       0 |       0 | 1-33              
 services/CompanyService             |       0 |        0 |       0 |       0 |                   
  CreateCompanyService.ts            |       0 |        0 |       0 |       0 | 1-39              
  DeleteCompanyService.ts            |       0 |        0 |       0 |       0 | 1-19              
  ListCompaniesService.ts            |       0 |        0 |       0 |       0 | 1-32              
  ShowCompanyService.ts              |       0 |        0 |       0 |       0 | 1-14              
  UpdateCompanyService.ts            |       0 |        0 |       0 |       0 | 1-52              
 services/ContactFormService         |       0 |        0 |       0 |       0 |                   
  CreateContactFormService.ts        |       0 |        0 |       0 |       0 | 1-76              
  DeleteContactFormService.ts        |       0 |        0 |       0 |       0 | 1-50              
  ListContactFormResponsesService.ts |       0 |        0 |       0 |       0 | 1-96              
  ListContactFormsService.ts         |       0 |        0 |       0 |       0 | 1-64              
  ShowContactFormService.ts          |       0 |        0 |       0 |       0 | 1-33              
  SubmitContactFormService.ts        |       0 |        0 |       0 |       0 | 1-95              
  UpdateContactFormService.ts        |       0 |        0 |       0 |       0 | 1-119             
 services/ContactServices            |       0 |        0 |       0 |       0 |                   
  CreateContactService.ts            |       0 |        0 |       0 |       0 | 1-49              
  CreateOrUpdateContactService.ts    |       0 |        0 |       0 |       0 | 1-62              
  DeleteContactService.ts            |       0 |        0 |       0 |       0 | 1-24              
  GetContactService.ts               |       0 |        0 |       0 |       0 | 1-42              
  ListContactsService.ts             |       0 |        0 |       0 |       0 | 1-53              
  ShowContactService.ts              |       0 |        0 |       0 |       0 | 1-39              
  UpdateContactService.ts            |       0 |        0 |       0 |       0 | 1-72              
 services/LeadService                |       0 |        0 |       0 |       0 |                   
  CreateLeadService.ts               |       0 |        0 |       0 |       0 | 1-91              
  FindLeadService.ts                 |       0 |        0 |       0 |       0 | 1-46              
  ListLeadsService.ts                |       0 |        0 |       0 |       0 | 1-62              
  UpdateLeadService.ts               |       0 |        0 |       0 |       0 | 1-46              
 services/MessageServices            |       0 |        0 |       0 |       0 |                   
  CreateMessageService.ts            |       0 |        0 |       0 |       0 | 1-101             
  ListMessagesService.ts             |       0 |        0 |       0 |       0 | 1-59              
 services/N8nService                 |       0 |        0 |       0 |       0 |                   
  N8nEscalateService.ts              |       0 |        0 |       0 |       0 | 1-214             
  N8nReplyService.ts                 |       0 |        0 |       0 |       0 | 1-109             
  N8nWebhookService.ts               |       0 |        0 |       0 |       0 | 1-332             
 services/PermissionServices         |       0 |        0 |       0 |       0 |                   
  ListPermissionsService.ts          |       0 |        0 |       0 |       0 | 1-29              
  UserHasPermissionService.ts        |       0 |        0 |       0 |       0 | 1-36              
 services/QueueService               |       0 |        0 |       0 |       0 |                   
  CreateQueueService.ts              |       0 |        0 |       0 |       0 | 1-68              
  DeleteQueueService.ts              |       0 |        0 |       0 |       0 | 1-17              
  ListQueuesService.ts               |       0 |        0 |       0 |       0 | 1-18              
  ShowQueueService.ts                |       0 |        0 |       0 |       0 | 1-24              
  UpdateQueueService.ts              |       0 |        0 |       0 |       0 | 1-80              
 services/QuickAnswerService         |       0 |        0 |       0 |       0 |                   
  CreateQuickAnswerService.ts        |       0 |        0 |       0 |       0 | 1-29              
  DeleteQuickAnswerService.ts        |       0 |        0 |       0 |       0 | 1-21              
  ListQuickAnswerService.ts          |       0 |        0 |       0 |       0 | 1-49              
  ShowQuickAnswerService.ts          |       0 |        0 |       0 |       0 | 1-21              
  UpdateQuickAnswerService.ts        |       0 |        0 |       0 |       0 | 1-42              
 services/ReportService              |       0 |        0 |       0 |       0 |                   
  index.ts                           |       0 |        0 |       0 |       0 | 1-685             
 services/ReservationService         |       0 |        0 |       0 |       0 |                   
  CreateReservationService.ts        |       0 |        0 |       0 |       0 | 1-45              
  DeleteReservationService.ts        |       0 |        0 |       0 |       0 | 1-21              
  ListReservationsService.ts         |       0 |        0 |       0 |       0 | 1-63              
  ShowReservationService.ts          |       0 |        0 |       0 |       0 | 1-27              
  UpdateReservationService.ts        |       0 |        0 |       0 |       0 | 1-44              
 services/RoleServices               |       0 |        0 |       0 |       0 |                   
  CreateRoleService.ts               |       0 |        0 |       0 |       0 | 1-40              
  DeleteRoleService.ts               |       0 |        0 |       0 |       0 | 1-26              
  ListRolesService.ts                |       0 |        0 |       0 |       0 | 1-19              
  ShowRoleService.ts                 |       0 |        0 |       0 |       0 | 1-23              
  UpdateRoleService.ts               |       0 |        0 |       0 |       0 | 1-55              
 services/SettingServices            |       0 |        0 |       0 |       0 |                   
  ListSettingByValueService.ts       |       0 |        0 |       0 |       0 | 1-22              
  ListSettingsService.ts             |       0 |        0 |       0 |       0 | 1-17              
  UpdateSettingService.ts            |       0 |        0 |       0 |       0 | 1-28              
 services/TelephonyServices          |       0 |        0 |       0 |       0 |                   
  ProcessCallHangupService.ts        |       0 |        0 |       0 |       0 | 1-96              
  ProcessIncomingCallService.ts      |       0 |        0 |       0 |       0 | 1-117             
 services/TicketServices             |       0 |        0 |       0 |       0 |                   
  CreateTicketService.ts             |       0 |        0 |       0 |       0 | 1-49              
  DeleteTicketService.ts             |       0 |        0 |       0 |       0 | 1-18              
  FindOrCreateTicketService.ts       |       0 |        0 |       0 |       0 | 1-101             
  ListTicketsService.ts              |       0 |        0 |       0 |       0 | 1-161             
  ShowTicketService.ts               |       0 |        0 |       0 |       0 | 1-66              
  UpdateTicketService.ts             |       0 |        0 |       0 |       0 | 1-112             
 services/UserServices               |   89.51 |    87.87 |   83.33 |   89.51 |                   
  AuthUserService.ts                 |     100 |      100 |     100 |     100 |                   
  CreateUserService.ts               |     100 |    81.81 |     100 |     100 | 42,64             
  DeleteUserService.ts               |       0 |        0 |       0 |       0 | 1-37              
  ListUsersService.ts                |     100 |      100 |     100 |     100 |                   
  ShowUserService.ts                 |     100 |      100 |     100 |     100 |                   
  UpdateUserService.ts               |     100 |    85.71 |     100 |     100 | 63                
 services/WbotServices               |       0 |        0 |       0 |       0 |                   
  CheckIsValidContact.ts             |       0 |        0 |       0 |       0 | 1-23              
  CheckNumber.ts                     |       0 |        0 |       0 |       0 | 1-13              
  DeleteWhatsAppMessage.ts           |       0 |        0 |       0 |       0 | 1-36              
  GetProfilePicUrl.ts                |       0 |        0 |       0 |       0 | 1-14              
  ImportContactsService.ts           |       0 |        0 |       0 |       0 | 1-41              
  SendDirectWhatsAppMessage.ts       |       0 |        0 |       0 |       0 | 1-59              
  SendWhatsAppMedia.ts               |       0 |        0 |       0 |       0 | 1-61              
  SendWhatsAppMessage.ts             |       0 |        0 |       0 |       0 | 1-47              
  StartAllWhatsAppsSessions.ts       |       0 |        0 |       0 |       0 | 1-12              
  StartWhatsAppSession.ts            |       0 |        0 |       0 |       0 | 1-26              
  wbotMessageListener.ts             |       0 |        0 |       0 |       0 | 1-548             
  wbotMonitor.ts                     |       0 |        0 |       0 |       0 | 1-78              
 services/WebchatService             |       0 |        0 |       0 |       0 |                   
  CreateWebchatChannelService.ts     |       0 |        0 |       0 |       0 | 1-72              
  CreateWebchatMessageService.ts     |       0 |        0 |       0 |       0 | 1-142             
  CreateWebchatSessionService.ts     |       0 |        0 |       0 |       0 | 1-105             
  DeleteWebchatChannelService.ts     |       0 |        0 |       0 |       0 | 1-24              
  GenerateWidgetScriptService.ts     |       0 |        0 |       0 |       0 | 1-54              
  GetWebchatSessionService.ts        |       0 |        0 |       0 |       0 | 1-45              
  ListWebchatChannelsService.ts      |       0 |        0 |       0 |       0 | 1-24              
  ShowWebchatChannelService.ts       |       0 |        0 |       0 |       0 | 1-30              
  UpdateWebchatChannelService.ts     |       0 |        0 |       0 |       0 | 1-84              
 services/WhatsappService            |       0 |        0 |       0 |       0 |                   
  AssociateWhatsappQueue.ts          |       0 |        0 |       0 |       0 | 1-12              
  CreateWhatsAppService.ts           |       0 |        0 |       0 |       0 | 1-94              
  DeleteWhatsAppService.ts           |       0 |        0 |       0 |       0 | 1-24              
  ListWhatsAppsService.ts            |       0 |        0 |       0 |       0 | 1-25              
  ShowWhatsAppService.ts             |       0 |        0 |       0 |       0 | 1-47              
  UpdateWhatsAppService.ts           |       0 |        0 |       0 |       0 | 1-91              
-------------------------------------|---------|----------|---------|---------|-------------------
Test Suites: 1 failed, 5 passed, 6 total
Tests:       11 passed, 11 total
Snapshots:   0 total
Time:        10.827 s
Ran all test suites.
