Database whaticket_test created or already exists.

> komu-backend@1.0.0 pretest
> NODE_ENV=test sequelize db:migrate && NODE_ENV=test sequelize db:seed:all


[4mSequelize CLI [Node: 24.13.0, CLI: 5.5.1, ORM: 5.22.5][24m

Loaded configuration file "dist/config/database.js".
(node:991939) [DEP0176] DeprecationWarning: fs.R_OK is deprecated, use fs.constants.R_OK instead
(Use `node --trace-deprecation ...` to show where the warning was created)
== 20200717133438-create-users: migrating =======
== 20200717133438-create-users: migrated (0.009s)

== 20200717144403-create-contacts: migrating =======
== 20200717144403-create-contacts: migrated (0.005s)

== 20200717145643-create-tickets: migrating =======
== 20200717145643-create-tickets: migrated (0.005s)

== 20200717151645-create-messages: migrating =======
== 20200717151645-create-messages: migrated (0.005s)

== 20200717170223-create-whatsapps: migrating =======
== 20200717170223-create-whatsapps: migrated (0.005s)

== 20200723200315-create-contacts-custom-fields: migrating =======
== 20200723200315-create-contacts-custom-fields: migrated (0.004s)

== 20200723202116-add-email-field-to-contacts: migrating =======
== 20200723202116-add-email-field-to-contacts: migrated (0.004s)

== 20200730153237-remove-user-association-from-messages: migrating =======
== 20200730153237-remove-user-association-from-messages: migrated (0.012s)

== 20200730153545-add-fromMe-to-messages: migrating =======
== 20200730153545-add-fromMe-to-messages: migrated (0.007s)

== 20200813114236-change-ticket-lastMessage-column-type: migrating =======
== 20200813114236-change-ticket-lastMessage-column-type: migrated (0.007s)

== 20200901235509-add-profile-column-to-users: migrating =======
== 20200901235509-add-profile-column-to-users: migrated (0.005s)

== 20200903215941-create-settings: migrating =======
== 20200903215941-create-settings: migrated (0.004s)

== 20200904220257-add-name-to-whatsapp: migrating =======
== 20200904220257-add-name-to-whatsapp: migrated (0.005s)

== 20200906122228-add-name-default-field-to-whatsapp: migrating =======
== 20200906122228-add-name-default-field-to-whatsapp: migrated (0.004s)

== 20200906155658-add-whatsapp-field-to-tickets: migrating =======
== 20200906155658-add-whatsapp-field-to-tickets: migrated (0.007s)

== 20200919124112-update-default-column-name-on-whatsappp: migrating =======
== 20200919124112-update-default-column-name-on-whatsappp: migrated (0.006s)

== 20200927220708-add-isDeleted-column-to-messages: migrating =======
== 20200927220708-add-isDeleted-column-to-messages: migrated (0.004s)

== 20200929145451-add-user-tokenVersion-column: migrating =======
== 20200929145451-add-user-tokenVersion-column: migrated (0.004s)

== 20200930162323-add-isGroup-column-to-tickets: migrating =======
== 20200930162323-add-isGroup-column-to-tickets: migrated (0.005s)

== 20200930194808-add-isGroup-column-to-contacts: migrating =======
== 20200930194808-add-isGroup-column-to-contacts: migrated (0.004s)

== 20201004150008-add-contactId-column-to-messages: migrating =======
== 20201004150008-add-contactId-column-to-messages: migrated (0.006s)

== 20201004155719-add-vcardContactId-column-to-messages: migrating =======
== 20201004155719-add-vcardContactId-column-to-messages: migrated (0.006s)

== 20201004955719-remove-vcardContactId-column-to-messages: migrating =======
== 20201004955719-remove-vcardContactId-column-to-messages: migrated (0.012s)

== 20201026215410-add-retries-to-whatsapps: migrating =======
== 20201026215410-add-retries-to-whatsapps: migrated (0.004s)

== 20201028124427-add-quoted-msg-to-messages: migrating =======
== 20201028124427-add-quoted-msg-to-messages: migrated (0.006s)

== 20210108001431-add-unreadMessages-to-tickets: migrating =======
== 20210108001431-add-unreadMessages-to-tickets: migrated (0.004s)

== 20210108164404-create-queues: migrating =======
== 20210108164404-create-queues: migrated (0.004s)

== 20210108164504-add-queueId-to-tickets: migrating =======
== 20210108164504-add-queueId-to-tickets: migrated (0.007s)

== 20210108174594-associate-whatsapp-queue: migrating =======
== 20210108174594-associate-whatsapp-queue: migrated (0.004s)

== 20210108204708-associate-users-queue: migrating =======
== 20210108204708-associate-users-queue: migrated (0.004s)

== 20210109192513-add-greetingMessage-to-whatsapp: migrating =======
== 20210109192513-add-greetingMessage-to-whatsapp: migrated (0.004s)

== 20210818102605-create-quickAnswers: migrating =======
== 20210818102605-create-quickAnswers: migrated (0.004s)

== 20211016014719-add-farewellMessage-to-whatsapp: migrating =======
== 20211016014719-add-farewellMessage-to-whatsapp: migrated (0.004s)

== 20220223095932-add-whatsapp-to-user: migrating =======
== 20220223095932-add-whatsapp-to-user: migrated (0.007s)

== 20260204130000-create-ai-agents: migrating =======
== 20260204130000-create-ai-agents: migrated (0.004s)

== 20260204130001-add-aiAgentId-to-whatsapp: migrating =======
== 20260204130001-add-aiAgentId-to-whatsapp: migrated (0.006s)

== 20260204140000-create-companies: migrating =======
== 20260204140000-create-companies: migrated (0.004s)

== 20260204140001-add-tenantId-to-all-tables: migrating =======
== 20260204140001-add-tenantId-to-all-tables: migrated (0.061s)

== 20260204140002-seed-default-company: migrating =======
== 20260204140002-seed-default-company: migrated (0.012s)

== 20260204160000-create-leads-table: migrating =======
== 20260204160000-create-leads-table: migrated (0.016s)

== 20260204170000-create-roles: migrating =======
== 20260204170000-create-roles: migrated (0.004s)

== 20260204170001-create-permissions: migrating =======
== 20260204170001-create-permissions: migrated (0.007s)

== 20260204170002-create-role-permissions: migrating =======
== 20260204170002-create-role-permissions: migrated (0.004s)

== 20260204170003-seed-roles-and-add-to-users: migrating =======
== 20260204170003-seed-roles-and-add-to-users: migrated (0.020s)

== 20260204180000-create-push-subscriptions: migrating =======
== 20260204180000-create-push-subscriptions: migrated (0.004s)

== 20260205100000-create-contact-forms: migrating =======
== 20260205100000-create-contact-forms: migrated (0.032s)

== 20260206100000-create-webchat-tables: migrating =======
== 20260206100000-create-webchat-tables: migrated (0.023s)

== 20260206130000-create-close-reasons: migrating =======
== 20260206130000-create-close-reasons: migrated (0.027s)

== 20260206133200-add-whatsappid-to-closereasons-contactforms: migrating =======
== 20260206133200-add-whatsappid-to-closereasons-contactforms: migrated (0.016s)

== 20260207030000-create-reservations: migrating =======
== 20260207030000-create-reservations: migrated (0.004s)

== 20260207040000-add-reservation-permissions: migrating =======
== 20260207040000-add-reservation-permissions: migrated (0.008s)

== 20260207150000-add-webchat-permissions: migrating =======
== 20260207150000-add-webchat-permissions: migrated (0.003s)

== 20260208050000-add-channel-to-tickets: migrating =======
== 20260208050000-add-channel-to-tickets: migrated (0.006s)

== 20260208050001-seed-default-webchat-channel: migrating =======
== 20260208050001-seed-default-webchat-channel: migrated (0.004s)

== 20260208120000-add-allowCompanySignup-to-settings: migrating =======
== 20260208120000-add-allowCompanySignup-to-settings: migrated (0.004s)

== 20260208170000-create-telephony-channel: migrating =======
== 20260208170000-create-telephony-channel: migrated (0.011s)


[4mSequelize CLI [Node: 24.13.0, CLI: 5.5.1, ORM: 5.22.5][24m

Loaded configuration file "dist/config/database.js".
(node:991966) [DEP0176] DeprecationWarning: fs.R_OK is deprecated, use fs.constants.R_OK instead
(Use `node --trace-deprecation ...` to show where the warning was created)
== 20200904070004-create-default-settings: migrating =======
== 20200904070004-create-default-settings: migrated (0.005s)

== 20200904070004-create-default-users: migrating =======
== 20200904070004-create-default-users: migrated (0.001s)

== 20200904070006-create-apiToken-settings: migrating =======
== 20200904070006-create-apiToken-settings: migrated (0.001s)

PASS src/__tests__/unit/User/UpdateUserService.spec.ts (9.713 s)
  ‚óè Console

    console.log
      Deprecation Warning: faker.random.number is now located in faker.datatype.number

      at Random.number (node_modules/faker/lib/random.js:37:13)

PASS src/__tests__/unit/User/DeleteUserService.spec.ts
  ‚óè Console

    console.log
      Deprecation Warning: faker.random.number is now located in faker.datatype.number

      at Random.number (node_modules/faker/lib/random.js:37:13)

PASS src/__tests__/unit/User/AuthUserService.spec.ts
  ‚óè Console

    console.log
      [DEBUG] AuthUserService found user: ID 1, Email Elmer.Hodkiewicz@hotmail.com, Hash $2a$08$gHUcPhya9vmVpecvjXBVd.Lzu0CYEhovzKTEdKHRSPYs1HWqrmVR6

      at src/services/UserServices/AuthUserService.ts:39:13

    console.log
      [DEBUG] checkPassword: Input 'EcPMGbPypigAibB' vs Stored '$2a$08$gHUcPhya9vmVpecvjXBVd.Lzu0CYEhovzKTEdKHRSPYs1HWqrmVR6' = true

      at User.<anonymous> (src/models/User.ts:97:13)

    console.log
      [DEBUG] AuthUserService found NO user for email Estella.Nolan@gmail.com

      at src/services/UserServices/AuthUserService.ts:41:13

    console.log
      [DEBUG] AuthUserService found user: ID 1, Email mail@test.com, Hash $2a$08$dclMaSOvh0.bR5/ODJ7eIuzFkR2fznKJflIosdfgd5eXydntWbe1G

      at src/services/UserServices/AuthUserService.ts:39:13

    console.log
      [DEBUG] checkPassword: Input 'ZSmC6DwmXFzADoE' vs Stored '$2a$08$dclMaSOvh0.bR5/ODJ7eIuzFkR2fznKJflIosdfgd5eXydntWbe1G' = false

      at User.<anonymous> (src/models/User.ts:97:13)

PASS src/__tests__/unit/User/CreateUserService.spec.ts
PASS src/__tests__/unit/User/ShowUserService.spec.ts
  ‚óè Console

    console.log
      Deprecation Warning: faker.random.number is now located in faker.datatype.number

      at Random.number (node_modules/faker/lib/random.js:37:13)

PASS src/__tests__/unit/User/ListUserService.spec.ts
-------------------------------------|---------|----------|---------|---------|----------------------------------------------------------------------------------
File                                 | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s                                                                
-------------------------------------|---------|----------|---------|---------|----------------------------------------------------------------------------------
All files                            |      11 |    25.38 |    4.61 |      11 |                                                                                  
 services                            |   30.76 |        0 |       0 |   30.76 |                                                                                  
  WebPushService.ts                  |   30.76 |        0 |       0 |   30.76 | 10-15,25-61,64-65                                                                
 services/AIAgentService             |       0 |        0 |       0 |       0 |                                                                                  
  CreateAIAgentService.ts            |       0 |        0 |       0 |       0 | 1-29                                                                             
  DeleteAIAgentService.ts            |       0 |        0 |       0 |       0 | 1-21                                                                             
  ListAIAgentsService.ts             |       0 |        0 |       0 |       0 | 1-34                                                                             
  ShowAIAgentService.ts              |       0 |        0 |       0 |       0 | 1-21                                                                             
  UpdateAIAgentService.ts            |       0 |        0 |       0 |       0 | 1-44                                                                             
 services/AuthServices               |       0 |        0 |       0 |       0 |                                                                                  
  RefreshTokenService.ts             |       0 |        0 |       0 |       0 | 1-47                                                                             
 services/BotStateService            |   62.79 |      100 |       0 |   62.79 |                                                                                  
  BotStateService.ts                 |   62.79 |      100 |       0 |   62.79 | 29-30,36-46,52-54,60-75,81-82,88-92,98-101,107-108,114-116                       
 services/CloseReasonService         |       0 |        0 |       0 |       0 |                                                                                  
  CreateCloseReasonService.ts        |       0 |        0 |       0 |       0 | 1-30                                                                             
  DeleteCloseReasonService.ts        |       0 |        0 |       0 |       0 | 1-22                                                                             
  ListCloseReasonsService.ts         |       0 |        0 |       0 |       0 | 1-39                                                                             
  ShowCloseReasonService.ts          |       0 |        0 |       0 |       0 | 1-21                                                                             
  UpdateCloseReasonService.ts        |       0 |        0 |       0 |       0 | 1-33                                                                             
 services/CompanyService             |       0 |        0 |       0 |       0 |                                                                                  
  CreateCompanyService.ts            |       0 |        0 |       0 |       0 | 1-39                                                                             
  DeleteCompanyService.ts            |       0 |        0 |       0 |       0 | 1-19                                                                             
  ListCompaniesService.ts            |       0 |        0 |       0 |       0 | 1-32                                                                             
  ShowCompanyService.ts              |       0 |        0 |       0 |       0 | 1-14                                                                             
  UpdateCompanyService.ts            |       0 |        0 |       0 |       0 | 1-52                                                                             
 services/ContactFormService         |       0 |        0 |       0 |       0 |                                                                                  
  CreateContactFormService.ts        |       0 |        0 |       0 |       0 | 1-76                                                                             
  DeleteContactFormService.ts        |       0 |        0 |       0 |       0 | 1-50                                                                             
  ListContactFormResponsesService.ts |       0 |        0 |       0 |       0 | 1-96                                                                             
  ListContactFormsService.ts         |       0 |        0 |       0 |       0 | 1-64                                                                             
  ShowContactFormService.ts          |       0 |        0 |       0 |       0 | 1-33                                                                             
  SubmitContactFormService.ts        |       0 |        0 |       0 |       0 | 1-95                                                                             
  UpdateContactFormService.ts        |       0 |        0 |       0 |       0 | 1-119                                                                            
 services/ContactServices            |   12.02 |        0 |       0 |   12.02 |                                                                                  
  CreateContactService.ts            |   40.81 |      100 |       0 |   40.81 | 19-47                                                                            
  CreateOrUpdateContactService.ts    |   33.87 |      100 |       0 |   33.87 | 20-60                                                                            
  DeleteContactService.ts            |       0 |        0 |       0 |       0 | 1-24                                                                             
  GetContactService.ts               |       0 |        0 |       0 |       0 | 1-42                                                                             
  ListContactsService.ts             |       0 |        0 |       0 |       0 | 1-53                                                                             
  ShowContactService.ts              |       0 |        0 |       0 |       0 | 1-39                                                                             
  UpdateContactService.ts            |       0 |        0 |       0 |       0 | 1-72                                                                             
 services/LeadService                |       0 |        0 |       0 |       0 |                                                                                  
  CreateLeadService.ts               |       0 |        0 |       0 |       0 | 1-91                                                                             
  FindLeadService.ts                 |       0 |        0 |       0 |       0 | 1-46                                                                             
  ListLeadsService.ts                |       0 |        0 |       0 |       0 | 1-62                                                                             
  UpdateLeadService.ts               |       0 |        0 |       0 |       0 | 1-46                                                                             
 services/MessageServices            |      15 |        0 |       0 |      15 |                                                                                  
  CreateMessageService.ts            |   23.76 |      100 |       0 |   23.76 | 23-99                                                                            
  ListMessagesService.ts             |       0 |        0 |       0 |       0 | 1-59                                                                             
 services/N8nService                 |      20 |        0 |       0 |      20 |                                                                                  
  N8nEscalateService.ts              |       0 |        0 |       0 |       0 | 1-214                                                                            
  N8nReplyService.ts                 |       0 |        0 |       0 |       0 | 1-109                                                                            
  N8nWebhookService.ts               |   39.45 |      100 |       0 |   39.45 | 115-175,181-289,295-312,318-330                                                  
 services/PermissionServices         |       0 |        0 |       0 |       0 |                                                                                  
  ListPermissionsService.ts          |       0 |        0 |       0 |       0 | 1-29                                                                             
  UserHasPermissionService.ts        |       0 |        0 |       0 |       0 | 1-36                                                                             
 services/QueueService               |       0 |        0 |       0 |       0 |                                                                                  
  CreateQueueService.ts              |       0 |        0 |       0 |       0 | 1-68                                                                             
  DeleteQueueService.ts              |       0 |        0 |       0 |       0 | 1-17                                                                             
  ListQueuesService.ts               |       0 |        0 |       0 |       0 | 1-18                                                                             
  ShowQueueService.ts                |       0 |        0 |       0 |       0 | 1-24                                                                             
  UpdateQueueService.ts              |       0 |        0 |       0 |       0 | 1-80                                                                             
 services/QuickAnswerService         |       0 |        0 |       0 |       0 |                                                                                  
  CreateQuickAnswerService.ts        |       0 |        0 |       0 |       0 | 1-29                                                                             
  DeleteQuickAnswerService.ts        |       0 |        0 |       0 |       0 | 1-21                                                                             
  ListQuickAnswerService.ts          |       0 |        0 |       0 |       0 | 1-49                                                                             
  ShowQuickAnswerService.ts          |       0 |        0 |       0 |       0 | 1-21                                                                             
  UpdateQuickAnswerService.ts        |       0 |        0 |       0 |       0 | 1-42                                                                             
 services/ReportService              |       0 |        0 |       0 |       0 |                                                                                  
  index.ts                           |       0 |        0 |       0 |       0 | 1-685                                                                            
 services/ReservationService         |       0 |        0 |       0 |       0 |                                                                                  
  CreateReservationService.ts        |       0 |        0 |       0 |       0 | 1-45                                                                             
  DeleteReservationService.ts        |       0 |        0 |       0 |       0 | 1-21                                                                             
  ListReservationsService.ts         |       0 |        0 |       0 |       0 | 1-63                                                                             
  ShowReservationService.ts          |       0 |        0 |       0 |       0 | 1-27                                                                             
  UpdateReservationService.ts        |       0 |        0 |       0 |       0 | 1-44                                                                             
 services/RoleServices               |       0 |        0 |       0 |       0 |                                                                                  
  CreateRoleService.ts               |       0 |        0 |       0 |       0 | 1-40                                                                             
  DeleteRoleService.ts               |       0 |        0 |       0 |       0 | 1-26                                                                             
  ListRolesService.ts                |       0 |        0 |       0 |       0 | 1-19                                                                             
  ShowRoleService.ts                 |       0 |        0 |       0 |       0 | 1-23                                                                             
  UpdateRoleService.ts               |       0 |        0 |       0 |       0 | 1-55                                                                             
 services/SettingServices            |       0 |        0 |       0 |       0 |                                                                                  
  ListSettingByValueService.ts       |       0 |        0 |       0 |       0 | 1-22                                                                             
  ListSettingsService.ts             |       0 |        0 |       0 |       0 | 1-17                                                                             
  UpdateSettingService.ts            |       0 |        0 |       0 |       0 | 1-28                                                                             
 services/TelephonyServices          |       0 |        0 |       0 |       0 |                                                                                  
  ProcessCallHangupService.ts        |       0 |        0 |       0 |       0 | 1-96                                                                             
  ProcessIncomingCallService.ts      |       0 |        0 |       0 |       0 | 1-117                                                                            
 services/TicketServices             |   11.83 |        0 |       0 |   11.83 |                                                                                  
  CreateTicketService.ts             |       0 |        0 |       0 |       0 | 1-49                                                                             
  DeleteTicketService.ts             |       0 |        0 |       0 |       0 | 1-18                                                                             
  FindOrCreateTicketService.ts       |   11.88 |      100 |       0 |   11.88 | 11-99                                                                            
  ListTicketsService.ts              |       0 |        0 |       0 |       0 | 1-161                                                                            
  ShowTicketService.ts               |   22.72 |      100 |       0 |   22.72 | 14-64                                                                            
  UpdateTicketService.ts             |   29.46 |      100 |       0 |   29.46 | 32-110                                                                           
 services/UserServices               |   99.43 |    89.18 |     100 |   99.43 |                                                                                  
  AuthUserService.ts                 |     100 |      100 |     100 |     100 |                                                                                  
  CreateUserService.ts               |     100 |    81.81 |     100 |     100 | 42,64                                                                            
  DeleteUserService.ts               |   94.59 |       80 |     100 |   94.59 | 31-32                                                                            
  ListUsersService.ts                |     100 |      100 |     100 |     100 |                                                                                  
  ShowUserService.ts                 |     100 |      100 |     100 |     100 |                                                                                  
  UpdateUserService.ts               |     100 |    85.71 |     100 |     100 | 63                                                                               
 services/WbotServices               |    6.15 |        0 |       0 |    6.15 |                                                                                  
  CheckIsValidContact.ts             |       0 |        0 |       0 |       0 | 1-23                                                                             
  CheckNumber.ts                     |       0 |        0 |       0 |       0 | 1-13                                                                             
  DeleteWhatsAppMessage.ts           |       0 |        0 |       0 |       0 | 1-36                                                                             
  GetProfilePicUrl.ts                |       0 |        0 |       0 |       0 | 1-14                                                                             
  ImportContactsService.ts           |       0 |        0 |       0 |       0 | 1-41                                                                             
  SendDirectWhatsAppMessage.ts       |       0 |        0 |       0 |       0 | 1-59                                                                             
  SendWhatsAppMedia.ts               |       0 |        0 |       0 |       0 | 1-61                                                                             
  SendWhatsAppMessage.ts             |       0 |        0 |       0 |       0 | 1-47                                                                             
  StartAllWhatsAppsSessions.ts       |       0 |        0 |       0 |       0 | 1-12                                                                             
  StartWhatsAppSession.ts            |       0 |        0 |       0 |       0 | 1-26                                                                             
  wbotMessageListener.ts             |   10.76 |      100 |       0 |   10.76 | 37-53,56-69,72-83,86-167,171-201,204-222,225-279,282-297,300-501,504-532,535-546 
  wbotMonitor.ts                     |       0 |        0 |       0 |       0 | 1-78                                                                             
 services/WebchatService             |       0 |        0 |       0 |       0 |                                                                                  
  CreateWebchatChannelService.ts     |       0 |        0 |       0 |       0 | 1-72                                                                             
  CreateWebchatMessageService.ts     |       0 |        0 |       0 |       0 | 1-142                                                                            
  CreateWebchatSessionService.ts     |       0 |        0 |       0 |       0 | 1-105                                                                            
  DeleteWebchatChannelService.ts     |       0 |        0 |       0 |       0 | 1-24                                                                             
  GenerateWidgetScriptService.ts     |       0 |        0 |       0 |       0 | 1-54                                                                             
  GetWebchatSessionService.ts        |       0 |        0 |       0 |       0 | 1-45                                                                             
  ListWebchatChannelsService.ts      |       0 |        0 |       0 |       0 | 1-24                                                                             
  ShowWebchatChannelService.ts       |       0 |        0 |       0 |       0 | 1-30                                                                             
  UpdateWebchatChannelService.ts     |       0 |        0 |       0 |       0 | 1-84                                                                             
 services/WhatsappService            |    4.09 |        0 |       0 |    4.09 |                                                                                  
  AssociateWhatsappQueue.ts          |       0 |        0 |       0 |       0 | 1-12                                                                             
  CreateWhatsAppService.ts           |       0 |        0 |       0 |       0 | 1-94                                                                             
  DeleteWhatsAppService.ts           |       0 |        0 |       0 |       0 | 1-24                                                                             
  ListWhatsAppsService.ts            |       0 |        0 |       0 |       0 | 1-25                                                                             
  ShowWhatsAppService.ts             |   25.53 |      100 |       0 |   25.53 | 11-45                                                                            
  UpdateWhatsAppService.ts           |       0 |        0 |       0 |       0 | 1-91                                                                             
-------------------------------------|---------|----------|---------|---------|----------------------------------------------------------------------------------

Test Suites: 6 passed, 6 total
Tests:       13 passed, 13 total
Snapshots:   0 total
Time:        20.525 s
Ran all test suites.
